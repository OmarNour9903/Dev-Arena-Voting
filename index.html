<!DOCTYPE html>
<html lang="ar">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Dev Arena Voting</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <style>
      body {
        background-color: #0f172a;
        color: #fff;
        font-family: "Poppins", sans-serif;
        padding: 40px 0;
      }
      .container { max-width: 1200px; }
      .team-card {
        background-color: #1e293b;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        transition: transform .2s ease;
      }
      .team-card:hover { transform: translateY(-5px); }
      .team-card img { width:100%; height:180px; object-fit:cover; }
      .team-info { padding:15px; text-align:center; }
      .vote-btn { margin-top:10px; width:100%; border-radius:10px; position:relative; transition:all .2s ease; }
      .btn-spinner {
        display:none;
        width:1rem; height:1rem;
        border:2px solid #fff; border-top-color:transparent;
        border-radius:50%; animation:spin .7s linear infinite; margin:auto;
      }
      @keyframes spin { to { transform: rotate(360deg); } }
      .alert { text-align:center; margin-top:20px; display:none; }
    </style>
  </head>

  <body>
    <div class="container text-center">
      <h1 class="mb-4 fw-bold">🎯 Dev Arena Voting</h1>
      <p class="mb-5">اختار التيم اللي عجبك وصوّت له ❤️</p>

      <div class="row g-4" id="teamsContainer"></div>

      <div id="alertBox" class="alert" role="alert"></div>
    </div>

    <script>
async function vote(team) {
  const button = document.getElementById(`vote-${team}`);
  button.disabled = true;
  const originalText = button.innerHTML;
  button.innerHTML = `<span class="spinner-border spinner-border-sm"></span>`;

  try {
    // ✅ إنشاء أو استرجاع الـ Device ID
    let deviceId = localStorage.getItem("deviceId");
    if (!deviceId) {
      deviceId = crypto.randomUUID();
      localStorage.setItem("deviceId", deviceId);
    }

    // ✅ الحصول على الـ IP
    const ipResponse = await fetch("https://api.ipify.org?format=json");
    const ipData = await ipResponse.json();
    const ip = ipData.ip;

    // ✅ إرسال البيانات للسيرفر
    const response = await fetch(
      "https://script.google.com/macros/s/AKfycbyVasgC_3qDN0WLRMqAwRMZHvMxLJTyT7wPo1gBbaZHZ_sbECRYQ2nUYcDmO-heDTyNBA/exec",
      {
        method: "POST",
        mode: "no-cors",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ team, ip, deviceId }),
      }
    );

    // مافيش رد مباشر بسبب no-cors، فنعمل رسالة عامة للمستخدم
    alert("✅ تم تسجيل صوتك بنجاح!");

  } catch (err) {
    console.error(err);
    alert("⚠️ حصل خطأ، حاول تاني بعد شوية.");
  } finally {
    button.disabled = false;
    button.innerHTML = originalText;
  }
}
</script>
  </body>
</html>
